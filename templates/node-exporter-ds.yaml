apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: node-exporter
spec:
  selector:
    matchLabels:
      name: node-exporter
  template:
    metadata:
      labels:
        name: node-exporter
    spec:
      tolerations:
      - key:  node-role.kubernetes.io/master
        effect: NoSchedule
      containers:
      - image: prom/node-exporter
        args: [
          "--path.procfs=/host/proc",
          "--path.sysfs=/host/sys",
          #"--collector.filesystem.ignored-mount-points=^/(sys|proc|dev|host|etc)($|/)",
          "- --collector.filesystem.ignored-mount-points=^/(sys|proc|dev|host|etc|rootfs/var/lib/docker/overlay)($|/)",
        ]
        name: node-exporter
        ports:
        - containerPort: 9100
          name: scrape
        volumeMounts:
        - name: dev
          mountPath: /host/dev
        - name: proc
          mountPath: /host/proc
        - name: sys
          mountPath: /host/sys
        - name: rootfs
          mountPath: /rootfs  
      hostNetwork: true
      hostPID: true
      volumes:
      - name: proc
        hostPath:
          path: /proc
      - name: dev
        hostPath:
          path: /dev
      - name: sys
        hostPath:
          path: /sys
      - name: rootfs
        hostPath: 
          path: /